<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestionnaire de mots de passe</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1-crypto-js.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f0f0f0;
    }
    h1, h2 {
      color: #333;
    }
    section {
      margin-bottom: 20px;
      background-color: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    label {
      display: block;
      margin-bottom: 10px;
    }
    input[type="text"], input[type="file"] {
      width: 100%;
      padding: 8px;
      margin: 5px 0 15px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px 15px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    pre {
      background-color: #f4f4f4;
      padding: 10px;
      border-radius: 4px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>

  <h1>Gestionnaire de mots de passe</h1>

  <!-- Ajouter un mot de passe -->
  <section>
    <h2>Ajouter un mot de passe</h2>
    <label for="nomAjout">Nom :</label>
    <input type="text" id="nomAjout" placeholder="Nom">
    <label for="idAjout">Identifiant :</label>
    <input type="text" id="idAjout" placeholder="Identifiant">
    <label for="mdpAjout">Mot de passe :</label>
    <input type="text" id="mdpAjout" placeholder="Mot de passe">
    <button onclick="ajouterMdpExistant()">Ajouter</button>
  </section>

  <!-- Afficher les mots de passe -->
  <section>
    <h2>Afficher les mots de passe</h2>
    <button onclick="afficherMotsDePasse()">Afficher</button>
    <pre id="affichage"></pre>
  </section>

  <!-- Exporter les données -->
  <section>
    <h2>Exporter les données</h2>
    <button onclick="exporterDonnees()">Exporter</button>
  </section>

  <!-- Importer des données -->
  <section>
    <h2>Importer des données</h2>
    <input type="file" onchange="importerDonnees(event)">
  </section>

  <script>
    // Fonction de chiffrement du mot de passe
    function chiffrer(motDePasse) {
      const sel = genererSel();
      const motDePasseChiffre = CryptoJS.AES.encrypt(motDePasse, sel).toString();
      return { motDePasseChiffre, sel };
    }

    // Fonction de déchiffrement du mot de passe
    function dechiffrer(motDePasseChiffre, sel) {
      const motDePasseDechiffre = CryptoJS.AES.decrypt(motDePasseChiffre, sel).toString(CryptoJS.enc.Utf8);
      return motDePasseDechiffre;
    }

    // Fonction pour générer un sel aléatoire
    function genererSel() {
      return CryptoJS.lib.WordArray.random(16).toString(CryptoJS.enc.Base64);
    }

    // Ajouter un mot de passe existant
    function ajouterMdpExistant() {
      const nom = document.getElementById("nomAjout").value;
      const identifiant = document.getElementById("idAjout").value;
      const motDePasse = document.getElementById("mdpAjout").value;

      if (!nom || !identifiant || !motDePasse) {
        alert("Tous les champs doivent être remplis.");
        return;
      }

      // Chiffrement du mot de passe avant de l'enregistrer
      const { motDePasseChiffre, sel } = chiffrer(motDePasse);
      enregistrer(nom, identifiant, motDePasseChiffre, sel);
      alert("Mot de passe ajouté !");
    }

    // Enregistrer dans le localStorage
    function enregistrer(nom, identifiant, motDePasseChiffre, sel) {
      const mdps = JSON.parse(localStorage.getItem("motsDePasse") || "[]");
      mdps.push({ nom, identifiant, motDePasseChiffre, sel });
      localStorage.setItem("motsDePasse", JSON.stringify(mdps));
    }

    // Afficher les mots de passe enregistrés
    function afficherMotsDePasse() {
      const mdps = JSON.parse(localStorage.getItem("motsDePasse") || "[]");
      const affichage = document.getElementById("affichage");

      if (mdps.length === 0) {
        affichage.textContent = "Aucun mot de passe enregistré.";
      } else {
        affichage.textContent = mdps.map(e => {
          const motDePasseDechiffre = dechiffrer(e.motDePasseChiffre, e.sel);
          return `${e.nom} : ${e.identifiant} : ${motDePasseDechiffre}`;
        }).join("\n");
      }
    }

    // Exporter les données
    function exporterDonnees() {
      const mdps = JSON.parse(localStorage.getItem("motsDePasse") || "[]");
      const jsonExport = JSON.stringify(mdps);
      const blob = new Blob([jsonExport], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'mots_de_passe.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Importer des données
    function importerDonnees(event) {
      const fichier = event.target.files[0];
      
      if (fichier) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const jsonData = e.target.result;
          const mdps = JSON.parse(jsonData);
          mdps.forEach(mdp => {
            enregistrer(mdp.nom, mdp.identifiant, mdp.motDePasseChiffre, mdp.sel);
          });
          alert("Données importées avec succès !");
        };
        reader.readAsText(fichier);
      }
    }
  </script>

</body>
</html>
